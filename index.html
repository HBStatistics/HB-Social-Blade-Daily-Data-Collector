<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HB Statistics • Social Blade Daily Data Collector</title>
  <link rel="icon" href="https://yt3.ggpht.com/veDA1FfRTsN5P5U97lgW9TRP4u0FnGRQIphD1DQs5TRvoHqZHU4xizu0UxIx5GMdnvKa8mkxQzw=s192-c-k-c0x00ffffff-no-rj" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap');

    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: linear-gradient(135deg, #1f005c, #5b0060, #870160, #a00062);
      font-family: 'Ubuntu', sans-serif;
      color: #eee;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a {
      color: #ff6acc;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    a:hover {
      color: #ff33ee;
    }

    header {
      position: sticky;
      top: 0;
      background: rgba(20, 0, 60, 0.85);
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-weight: 700;
      font-size: 1.75rem;
      letter-spacing: 1.3px;
      user-select: none;
    }

    main {
      flex-grow: 1;
      max-width: 960px;
      margin: 2rem auto 3rem auto;
      background: rgba(10, 0, 40, 0.9);
      padding: 2rem 2.5rem;
      border-radius: 16px;
      box-shadow: 0 0 30px #a00062aa;
    }

    label[for="rawDataInput"] {
      display: block;
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      color: #ff99ee;
      user-select: none;
    }
    textarea#rawDataInput {
      width: 100%;
      height: 180px;
      font-family: monospace;
      font-size: 1rem;
      background-color: #1a002f;
      border: 2px solid #ff33ee;
      border-radius: 12px;
      color: #eee;
      padding: 1rem;
      resize: vertical;
      transition: border-color 0.3s ease;
      box-shadow: 0 0 15px #ff33ee55 inset;
    }
    textarea#rawDataInput:focus {
      border-color: #ff66ff;
      outline: none;
      box-shadow: 0 0 20px #ff66ffaa inset;
    }

    .btn {
      background: #ff33ee;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      padding: 0.75rem 2rem;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 1.5rem;
      box-shadow: 0 0 10px #ff33eeaa;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    .btn:hover, .btn:focus {
      background: #ff66ff;
      box-shadow: 0 0 20px #ff66ffaa;
      outline: none;
    }

    .options {
      margin-top: 2rem;
      font-size: 1.1rem;
      user-select: none;
      color: #ffc0ff;
    }

    #exData {
      margin-top: 2rem;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      background: #2d004f;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: inset 0 0 15px #ff33ee99;
      white-space: pre-wrap;
      color: #ffddff;
      font-size: 0.95rem;
    }

    #buttons {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    #buttons button {
      background: #881166;
      border-radius: 10px;
      padding: 0.5rem 1.3rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: #fff;
      box-shadow: 0 0 8px #a0329a;
      transition: background 0.25s ease;
      cursor: pointer;
    }
    #buttons button:hover {
      background: #bb44cc;
    }

    #exportButtons {
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    #exportButtons button {
      background: #aa00aa;
      border-radius: 12px;
      padding: 0.75rem 1.8rem;
      font-size: 1rem;
      font-weight: 700;
      color: #ffe6ff;
      box-shadow: 0 0 15px #d241d2cc;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #exportButtons button:hover {
      background: #cc33cc;
    }
  </style>
</head>

<body>

<header>
  <h1>HB Statistics • Social Blade Collector</h1>
</header>

<main>
  <label for="rawDataInput">Paste Social Blade Monthly Snapshot Source:</label>
  <textarea id="rawDataInput" placeholder="Paste the full monthly snapshot page source here..."></textarea>
  <button class="btn" onclick="addify()">Process Data</button>

  <div id="buttons"></div>

  <div class="options">
    <label><input type="radio" name="hon-vir-data" id="hon"> Printed data horizontally</label><br>
    <label><input type="radio" name="hon-vir-data" id="vir" checked> Printed data vertically</label>
  </div>

  <div id="exportButtons">
    <button onclick="downloadCSV()">Export CSV</button>
    <button onclick="downloadJSON()">Export JSON</button>
  </div>

  <label style="font-size:1.8rem; color:white; margin-top:2rem;">Preview</label>
  <div id="exData"></div>
</main>

<script>

function copy(text){navigator.clipboard.writeText(text)}

let countsArrays={c1:[],c2:[],c3:[],c4:[]}
let processedData=[]

function parseDate(str){let d=new Date(str);return isNaN(d)?null:d}
function formatDate(d){return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}
function fillMissingDates(data, dateKey, valueKeys) {
  const filled = [];
  for (let i = 0; i < data.length - 1; i++) {
    const current = data[i];
    const next = data[i + 1];

    filled.push(current);

    const currentDate = parseDate(current[dateKey]);
    const nextDate = parseDate(next[dateKey]);
    const diffDays = Math.round((nextDate - currentDate) / (1000 * 60 * 60 * 24));

    if (diffDays > 1) {
      const gap = diffDays - 1;
      for (let j = 1; j <= gap; j++) {
        const newDate = new Date(currentDate);
        newDate.setDate(newDate.getDate() + j);
        const interp = {};
        interp[dateKey] = formatDate(newDate);

        valueKeys.forEach(key => {
          const v1 = Number(current[key]) || 0;
          const v2 = Number(next[key]) || 0;
          const valInterp = v1 + ((v2 - v1) / diffDays) * j;
          interp[key] = Math.round(valInterp);
        });

        filled.push(interp);
      }
    }
  }
  filled.push(data[data.length - 1]);
  return filled;
}

/* ⭐ NEW DAILY GAIN CALCULATOR — PERFECTLY ACCURATE */
function calculateDailyGains(arr){
  const gains=[0];
  for(let i=1;i<arr.length;i++){
    gains.push(arr[i]-arr[i-1]);
  }
  return gains;
}

function addify(){
  const rawInput=document.getElementById("rawDataInput").value.trim();
  if(!rawInput){alert("Please paste your Social Blade monthly snapshot source code.");return;}

  countsArrays={c1:[],c2:[],c3:[],c4:[]};
  processedData=[];

  let acData=rawInput;
  let newACDATA=acData.split('"').join("").split(" + ").join("").split(/\\/g);
  for(let i=1;i<newACDATA.length;i++){
    newACDATA[i]=newACDATA[i].split("n").join("");
  }
  newACDATA=newACDATA.join("\n");
  acData=newACDATA;

  const lines=acData.split("\n").filter(line=>line.trim()!=="");
  if(lines.length===0){alert("No data lines found. Check your input.");return;}

  const headers=lines[0].split(",").map(h=>h.trim());
  if(headers.length<2){alert("At least date + 1 data column required.");return;}

  for(let i=1;i<lines.length;i++){
    const parts=lines[i].split(",");
    if(parts.length<headers.length)continue;
    const obj={};
    for(let j=0;j<headers.length;j++){
      obj[headers[j]]=parts[j];
    }
    processedData.push(obj);
  }

  if(processedData.length===0){alert("No valid data rows found.");return;}

  processedData.sort((a,b)=>{
    const d1=parseDate(a[headers[0]]);
    const d2=parseDate(b[headers[0]]);
    if(d1&&d2)return d1-d2;
    return 0;
  });

  const valueKeys=headers.slice(1);
  processedData=fillMissingDates(processedData,headers[0],valueKeys);

  countsArrays.c1=processedData.map(d=>d[headers[0]]);
  valueKeys.forEach((key,idx)=>{
    countsArrays["c"+(idx+2)]=processedData.map(d=>Number(d[key]));
  });

  /* ⭐ DAILY GAINS ARE GENERATED HERE USING c2 (subscribers) */
  const subsArray = countsArrays.c2;
  const dailyGains = calculateDailyGains(subsArray);
  countsArrays.c3 = dailyGains;

  const exDataDiv=document.getElementById("exData");
  const buttonsDiv=document.getElementById("buttons");
  const isVertical=document.getElementById("vir").checked;

  exDataDiv.innerHTML="";
  buttonsDiv.innerHTML="";

  if(isVertical){
    for(let i=0;i<processedData.length;i++){
      exDataDiv.innerHTML+=`${countsArrays.c1[i]},${countsArrays.c2[i]},${countsArrays.c3[i]}<br>`;
    }

    buttonsDiv.innerHTML+=`<button onclick="copy(countsArrays.c1.join('\\n'))">Copy Dates</button>`;
    buttonsDiv.innerHTML+=`<button onclick="copy(countsArrays.c2.join('\\n'))">Copy Subs</button>`;
    buttonsDiv.innerHTML+=`<button onclick="copy(countsArrays.c3.join('\\n'))">Copy Gains</button>`;

  } else {

    exDataDiv.innerHTML+=`Dates,${countsArrays.c1.join(",")}<br>`;
    exDataDiv.innerHTML+=`Subs,${countsArrays.c2.join(",")}<br>`;
    exDataDiv.innerHTML+=`Gains,${countsArrays.c3.join(",")}<br>`;

    buttonsDiv.innerHTML+=`<button onclick="copy(countsArrays.c1.join('\\t'))">Copy Dates</button>`;
    buttonsDiv.innerHTML+=`<button onclick="copy(countsArrays.c2.join('\\t'))">Copy Subs</button>`;
    buttonsDiv.innerHTML+=`<button onclick="copy(countsArrays.c3.join('\\t'))">Copy Gains</button>`;
  }
}
function downloadCSV(){
  if(processedData.length===0){
    alert("No data to export. Please process data first.");
    return;
  }

  let csv = "Date,Subscribers,DailyGain\n";

  for(let i = 0; i < countsArrays.c1.length; i++){
    csv += `${countsArrays.c1[i]},${countsArrays.c2[i]},${countsArrays.c3[i]}\n`;
  }

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "socialblade_data.csv";
  a.click();
  URL.revokeObjectURL(url);
}

function downloadJSON(){
  if(processedData.length===0){
    alert("No data to export. Please process data first.");
    return;
  }

  const jsonArr = [];

  for(let i = 0; i < countsArrays.c1.length; i++){
    jsonArr.push({
      date: countsArrays.c1[i],
      subscribers: countsArrays.c2[i],
      daily_gain: countsArrays.c3[i]
    });
  }

  const jsonContent = JSON.stringify(jsonArr, null, 2);
  const blob = new Blob([jsonContent], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "socialblade_data.json";
  a.click();
  URL.revokeObjectURL(url);
}

</script>

</body>
</html>

